var y=Object.defineProperty;var P=(t,e,s)=>e in t?y(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;var c=(t,e,s)=>(P(t,typeof e!="symbol"?e+"":e,s),s);import{c as C,cG as H,cH as F,cI as S,r as i,j as n,a5 as M,M as $,cJ as q,u as L,a as z,g as G,J as N,cK as I,W as J,cL as W,c4 as w,cM as D,I as R,co as B,cN as O}from"./index.59694a49.js";/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M12 18v-6",key:"17g6i2"}],["path",{d:"m9 15 3 3 3-3",key:"1npd3o"}]],k=C("FileDown",_);const A=`${S}/generation/create`;class K{constructor(){c(this,"processing");c(this,"connection");c(this,"message");c(this,"onProcessingChange");c(this,"onMessage");c(this,"onError");c(this,"onFinished");this.processing=!1,this.connection=null,this.message=""}setProcessingChangeHandler(e){this.onProcessingChange=e}setMessageHandler(e){this.onMessage=e}setErrorHandler(e){this.onError=e}setFinishedHandler(e){this.onFinished=e}isProcessing(){return this.processing}setProcessing(e){var s;return this.processing=e,e||(this.connection=null,this.message=""),(s=this.onProcessingChange)==null||s.call(this,e),e}getConnection(){return this.connection}handleMessage(e){var s,r,o;if(e.error&&e.end){(s=this.onError)==null||s.call(this,e.error),this.setProcessing(!1);return}this.message+=e.message,(r=this.onMessage)==null||r.call(this,{message:this.message,quota:e.quota}),e.end&&((o=this.onFinished)==null||o.call(this,e.hash),this.setProcessing(!1))}generate(e,s){this.setProcessing(!0);const r=H(F)||"anonymous";r&&(this.connection=new WebSocket(A),this.connection.onopen=()=>{var o;(o=this.connection)==null||o.send(JSON.stringify({token:r,prompt:e,model:s}))},this.connection.onmessage=o=>{this.handleMessage(JSON.parse(o.data))},this.connection.onclose=()=>{this.setProcessing(!1)})}generateWithBlock(e,s){return this.isProcessing()?!1:(this.generate(e,s),!0)}}const d=new K;function Q({onSend:t}){const{t:e}=L(),s=i.useRef(null),[r,o]=i.useState(!1),[g,u]=i.useState(""),[b,m]=i.useState(""),[p,f]=i.useState(0),h=z(G),x=i.useRef(h);function E(){m(""),f(0),u("")}d.setMessageHandler(({message:a,quota:l})=>{m(a),f(l)}),d.setErrorHandler(a=>{N.error(e("generate.failed"),{description:`${e("generate.reason")} ${a}`})}),d.setFinishedHandler(a=>{N.success(e("generate.success"),{description:e("generate.success-prompt")}),u(a)});function j(a="gpt-3.5-16k"){const l=s.current;if(!l)return;const v=l.value.trim();v.length&&t!=null&&t(v,a)&&(o(!0),E(),l.value="")}return i.useEffect(()=>{const a=s.current;if(a)return a.focus(),a.removeEventListener("keydown",()=>{}),a.addEventListener("keydown",l=>{I(l)&&j(x.current)}),()=>{s.current&&s.current.removeEventListener("keydown",()=>{})}},[s]),i.useEffect(()=>{x.current=h},[h]),n.jsxs("div",{className:"generation-wrapper",children:[r?n.jsxs("div",{className:"box",children:[p>0&&n.jsxs("div",{className:"quota-box",children:[n.jsx(J,{className:"h-4 w-4 mr-2"}),p.toFixed(2)]}),n.jsx("pre",{className:"message-box",children:W(b)||e("generate.empty")}),g.length>0&&n.jsxs("div",{className:"hash-box",children:[n.jsxs("a",{className:"download-box",href:`${w}/generation/download/tar?hash=${g}`,children:[n.jsx(k,{className:"h-6 w-6"}),n.jsx("p",{children:e("generate.download",{name:"tar.gz"})})]}),n.jsxs("a",{className:"download-box",href:`${w}/generation/download/zip?hash=${g}`,children:[n.jsx(k,{className:"h-6 w-6"}),n.jsx("p",{children:e("generate.download",{name:"zip"})})]})]})]}):n.jsxs("div",{className:"product",children:[n.jsx("img",{src:D,alt:""}),"AI Code Generator"]}),n.jsxs("div",{className:"generate-box",children:[n.jsx(R,{className:"input",ref:s,placeholder:e("generate.input-placeholder")}),n.jsx(M,{size:"icon",className:"action",variant:"default",onClick:()=>j(h),children:n.jsx(B,{className:"h-5 w-5"})})]}),n.jsx("div",{className:"model-box",children:n.jsx(O,{side:"bottom"})})]})}function Z(){const[t,e]=i.useState(!1);return d.setProcessingChangeHandler(e),n.jsx("div",{className:"generation-page",children:n.jsxs("div",{className:"generation-container",children:[n.jsx(M,{className:"action",variant:"ghost",size:"icon",onClick:()=>$.navigate("/"),disabled:t,children:n.jsx(q,{className:"h-5 w-5 back"})}),n.jsx(Q,{onSend:(s,r)=>(console.debug(`[generation] create generation request (prompt: ${s}, model: ${r})`),d.generateWithBlock(s,r))})]})})}export{Z as default};
