import{u as p,a as D,bA as v,r as l,bG as y,j as a,a5 as o,eH as C,eI as T,bH as k,dr as A,bJ as B,cP as S,a3 as E,a4 as H,ac as L,a6 as I,a7 as M,a8 as O,as as J,d0 as F,cm as P,L as $,a9 as z,aa as V,bd as q,eJ as G,aL as f,az as K,aA as _,aB as Q,aC as U,c6 as W,aE as X,aF as Y,eK as Z,b$ as R,aH as aa,aI as ea,aJ as sa,bv as b,E as ta,eL as na,bk as ra,eM as ia,J as w,bR as la,bS as ca,bT as da,bV as oa}from"./index.59694a49.js";import{T as xa,a as ha,b as N,c as m,d as ma,e as j}from"./table.ca326b4a.js";import{E as ja}from"./ellipsis-vertical.05a6dda3.js";import"./funnel.1dc762bc.js";function ua(s){const{t:e}=p(),[t,c]=l.useState(!1),[i,d]=l.useState(""),[r,x]=l.useState(!1);async function h(){var g;const n=i.trim();if(n.length===0)return;const u=await ia(n,r);u.status?(w.success(e("admin.post-success"),{description:e("admin.post-success-prompt")}),d(""),x(!1),c(!1),(g=s.onCreated)==null||g.call(s)):w.error(e("admin.post-failed"),{description:e("admin.post-failed-prompt",{reason:u.error})})}return a.jsxs(E,{open:t,onOpenChange:c,children:[a.jsx(H,{asChild:!0,children:a.jsxs(o,{variant:"default",children:[a.jsx(L,{className:"w-4 h-4 mr-1"}),e("admin.create-broadcast")]})}),a.jsxs(I,{children:[a.jsxs(M,{children:[a.jsx(O,{children:e("admin.create-broadcast")}),a.jsx(J,{asChild:!0,children:a.jsxs("div",{className:"pt-4",children:[a.jsx("p",{className:"text-sm text-secondary mb-6 border p-2 rounded-md",children:e("admin.broadcast-tip")}),a.jsx(F,{placeholder:e("admin.broadcast-placeholder"),value:i,rows:5,onChange:n=>d(n.target.value)}),a.jsxs("div",{className:"flex items-center space-x-2 mt-4",children:[a.jsx(P,{id:"notify-all",checked:r,onCheckedChange:n=>x(n)}),a.jsx($,{htmlFor:"notify-all",className:"text-sm font-medium text-primary cursor-pointer",children:e("admin.notify-all")})]})]})})]}),a.jsxs(z,{children:[a.jsx(V,{asChild:!0,children:a.jsx(o,{variant:"outline",children:e("admin.cancel")})}),a.jsx(o,{unClickable:!0,variant:"default",onClick:h,loading:!0,children:e("admin.post")})]})]})]})}function pa({item:s,onRefresh:e}){const{t}=p(),[c,i]=l.useState(!1),[d,r]=l.useState(!1),[x,h]=l.useState("");return a.jsxs(N,{children:[a.jsx(q,{title:t("admin.view"),value:x||s.content,onChange:h,open:c,setOpen:i,submittable:!0,onSubmit:async n=>{const u=await G(s.index,n);f(t,u,!0),e==null||e()}}),a.jsxs(K,{open:d,onOpenChange:r,children:[a.jsx(_,{asChild:!0}),a.jsxs(Q,{children:[a.jsxs(U,{children:[a.jsx(W,{children:t("admin.delete-broadcast")}),a.jsx(X,{children:a.jsx("p",{children:t("admin.delete-broadcast-desc")})})]}),a.jsxs(Y,{children:[a.jsx(o,{unClickable:!0,variant:"outline",children:t("cancel")}),a.jsx(o,{unClickable:!0,variant:"destructive",onClick:async()=>{const n=await Z(s.index);f(t,n,!0),e==null||e(),n.status&&r(!1)},children:t("delete")})]})]})]}),a.jsx(j,{children:s.index}),a.jsx(j,{children:R(s.content,25)}),a.jsx(j,{children:s.poster}),a.jsx(j,{children:s.created_at}),a.jsx(j,{children:a.jsxs(aa,{children:[a.jsx(ea,{asChild:!0,children:a.jsx(o,{variant:"outline",size:"icon",children:a.jsx(ja,{className:"w-4 h-4"})})}),a.jsxs(sa,{align:"end",children:[a.jsxs(b,{onClick:()=>i(!0),children:[a.jsx(ta,{className:"w-4 h-4 mr-1.5"}),t("admin.view")]}),a.jsxs(b,{onClick:()=>i(!0),children:[a.jsx(na,{className:"w-4 h-4 mr-1.5"}),t("edit")]}),a.jsxs(b,{onClick:()=>r(!0),children:[a.jsx(ra,{className:"w-4 h-4 mr-1.5"}),t("delete")]})]})]})})]})}function ba(){const{t:s}=p(),e=D(v),[t,c]=l.useState([]),[i,d]=l.useState(!1),r=async()=>{e&&(d(!0),c(await C()),d(!1))};return y(r,[e]),a.jsxs("div",{className:"broadcast-table whitespace-nowrap",children:[a.jsxs("div",{className:"broadcast-action flex flex-row flex-nowrap w-full mb-4",children:[a.jsx(o,{variant:"outline",size:"icon",className:"select-none",onClick:async()=>{c(await C())},children:a.jsx(T,{className:"w-4 h-4"})}),a.jsx("div",{className:"grow"}),a.jsx(ua,{onCreated:r})]}),a.jsxs(k,{className:"pb-2 mb-4",children:[a.jsx(A,{className:"h-4 w-4"}),a.jsx(B,{className:"break-all whitespace-pre-wrap",children:s("admin.broadcast-tip")})]}),t.length?a.jsxs(xa,{children:[a.jsx(ha,{children:a.jsxs(N,{className:"select-none whitespace-nowrap",children:[a.jsx(m,{children:"ID"}),a.jsx(m,{children:s("admin.broadcast-content")}),a.jsx(m,{children:s("admin.poster")}),a.jsx(m,{children:s("admin.post-at")}),a.jsx(m,{children:s("admin.action")})]})}),a.jsx(ma,{children:t.map((x,h)=>a.jsx(pa,{item:x,onRefresh:r},h))})]}):a.jsx("div",{className:"text-center select-none my-8",children:i?a.jsx(S,{className:"w-6 h-6 inline-block animate-spin"}):a.jsx("p",{className:"empty",children:s("admin.empty")})})]})}function Na(){const{t:s}=p();return a.jsx("div",{className:"broadcast",children:a.jsxs(la,{className:"admin-card broadcast-card",children:[a.jsx(ca,{className:"select-none",children:a.jsx(da,{children:s("admin.broadcast")})}),a.jsx(oa,{children:a.jsx(ba,{})})]})})}export{Na as default};
