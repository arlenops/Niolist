import{c as K,aq as L,ar as $,u as O,r as m,bG as ee,j as e,a5 as x,ac as xe,dw as ge,d as ue,I as k,aV as ve,e as se,ap as J,X as H,bM as re,aL as b,bk as le,dx as we,bs as ye,L as V,dy as fe,a3 as Ne,a6 as Ce,a7 as be,a8 as ke,a9 as Se,aa as _e,dz as Te,dA as Me,aR as Pe,a as De,bB as Le,cP as $e,dB as Ae,dC as X,dD as Ve,dE as Be,dF as Z,dG as A,dH as z,O as _,dI as ce,dJ as ie,dK as te,cn as Ie,aH as ze,aI as He,aJ as Oe,dL as qe,dM as Ee,dN as Re,dO as Fe,d0 as Ge,bL as Q,bh as We,b as oe,bO as Ke,cK as Je,dP as Xe,bR as Ze,bS as Qe,bT as Ue,bV as Ye}from"./index.59694a49.js";import{u as es,C as ss,T as ns,a as as,b as de,e as p,d as rs}from"./table.ca326b4a.js";import{O as T}from"./OperationAction.02f00643.js";import{g as ls,b as W,a as cs,c as U,C as is,P as R,p as F}from"./hook.891b1d97.js";import{A as ts}from"./activity.8e8b97fa.js";import{S as os}from"./square-asterisk.60547e9d.js";import{P as ds,a as D,b as G,c as Y}from"./Paragraph.e7cb6a63.js";import{B as ms}from"./book-dashed.b14c78b1.js";import"./funnel.1dc762bc.js";import"./groups.c24f8e23.js";import"./accordion.31111ca3.js";/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hs=[["path",{d:"m3 16 4 4 4-4",key:"1co6wj"}],["path",{d:"M7 20V4",key:"1yoxec"}],["path",{d:"M17 10V4h-2",key:"zcsr5x"}],["path",{d:"M15 10h4",key:"id2lce"}],["rect",{x:"15",y:"14",width:"4",height:"6",ry:"2",key:"33xykx"}]],ps=K("ArrowDown10",hs);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xs=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["line",{x1:"3",x2:"21",y1:"9",y2:"9",key:"1vqk6q"}],["line",{x1:"3",x2:"21",y1:"15",y2:"15",key:"o2sbyz"}],["line",{x1:"9",x2:"9",y1:"9",y2:"21",key:"1ib60c"}],["line",{x1:"15",x2:"15",y1:"9",y2:"21",key:"1n26ft"}]],us=K("Sheet",xs);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ys=[["circle",{cx:"12",cy:"5",r:"3",key:"rqqgnr"}],["path",{d:"M6.5 8a2 2 0 0 0-1.905 1.46L2.1 18.5A2 2 0 0 0 4 21h16a2 2 0 0 0 1.925-2.54L19.4 9.5A2 2 0 0 0 17.48 8Z",key:"56o5sh"}]],js=K("Weight",ys);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gs=[["rect",{width:"8",height:"8",x:"3",y:"3",rx:"2",key:"by2w9f"}],["path",{d:"M7 11v4a2 2 0 0 0 2 2h4",key:"xkn7yn"}],["rect",{width:"8",height:"8",x:"13",y:"13",rx:"2",key:"1cgmvn"}]],vs=K("Workflow",gs);async function ws(){try{return(await L.get("/admin/channel/list")).data}catch(s){return{status:!1,error:$(s),data:[]}}}async function fs(s){try{return(await L.get(`/admin/channel/get/${s}`)).data}catch(a){return{status:!1,error:$(a)}}}async function Ns(s){try{return(await L.post("/admin/channel/create",s)).data}catch(a){return{status:!1,error:$(a)}}}async function Cs(s,a){try{return(await L.post(`/admin/channel/update/${s}`,a)).data}catch(l){return{status:!1,error:$(l)}}}async function me(s){try{return(await L.get(`/admin/channel/delete/${s}`)).data}catch(a){return{status:!1,error:$(a)}}}async function he(s){try{return(await L.get(`/admin/channel/activate/${s}`)).data}catch(a){return{status:!1,error:$(a)}}}async function pe(s){try{return(await L.get(`/admin/channel/deactivate/${s}`)).data}catch(a){return{status:!1,error:$(a)}}}function ne({type:s,className:a,variant:l}){const c=m.useMemo(()=>ls(s),[s]);return e.jsx(ye,{className:se("select-none w-max cursor-pointer",a),variant:l,children:c||s})}function bs({dispatch:s,open:a,setOpen:l}){const{t:c}=O(),[y,h]=m.useState("https://api.openai.com"),[n,v]=m.useState(""),j=async o=>{o=o.trim(),o.endsWith("/")&&(o=o.slice(0,-1));const f=await Te(n,{endpoint:o});if(b(c,f,!0),!f.status)return!1;const N={id:-1,name:Me(o).replace(/\./g,"-"),type:"openai",models:f.data,priority:0,weight:1,retry:3,secret:n,endpoint:o,mapper:"",state:!0,group:[],proxy:{proxy:"",proxy_type:0,username:"",password:""}};return s({type:"set",value:N}),!0};return e.jsx(e.Fragment,{children:e.jsx(Ne,{open:a,onOpenChange:l,children:e.jsxs(Ce,{children:[e.jsx(be,{children:e.jsx(ke,{children:c("admin.channels.joint")})}),e.jsxs("div",{className:"pt-2 flex flex-col",children:[e.jsxs("div",{className:"flex flex-row items-center mb-4",children:[e.jsx(V,{className:"mr-2 whitespace-nowrap",children:c("admin.channels.joint-endpoint")}),e.jsx(k,{value:y,onChange:o=>h(o.target.value),placeholder:c("admin.channels.upstream-endpoint-placeholder")})]}),e.jsxs("div",{className:"flex flex-row items-center",children:[e.jsx(V,{className:"mr-2 whitespace-nowrap",children:c("admin.channels.secret")}),e.jsx(k,{value:n,onChange:o=>v(o.target.value),placeholder:c("admin.channels.sync-secret-placeholder")})]})]}),e.jsxs(Se,{children:[e.jsx(_e,{asChild:!0,children:e.jsx(x,{variant:"outline",children:c("cancel")})}),e.jsx(x,{unClickable:!0,className:"mb-1",onClick:async()=>{await j(y)&&l(!1)},children:c("confirm")})]})]})})})}function ks({display:s,dispatch:a,setId:l,setEnabled:c,data:y,setData:h}){const{t:n}=O(),[v,j]=m.useState(""),[o,f]=m.useState(!1),[M,N]=m.useState(!1),[S,q]=m.useState(!1),g=async()=>{f(!0);const i=await ws();f(!1),i.status?h(i.data):b(n,i)};ee(g,[]),ee(g,[s]),m.useEffect(()=>{s&&l(-1)},[s]);const{bar:P,toggle:C,merge:d}=es({id:!0,name:!0,type:!0,priority:!0,weight:!0,"secret-number":!0,"retry-name":!0,state:!0,action:!0},{translatePrefix:"admin.channels"}),B=m.useMemo(()=>{const i=y||[],w=v.trim().toLowerCase();return w.trim()===""?i:i.filter(t=>t.name.toLowerCase().includes(w)||t.type.toLowerCase().includes(w)||t.secret.toLowerCase().includes(w)||t.models.some(E=>E.toLowerCase().includes(w)))},[v,y]);return s&&e.jsxs("div",{children:[e.jsx(bs,{open:M,setOpen:N,dispatch:i=>{a(i),c(!0),l(-1)}}),e.jsxs("div",{className:"flex flex-row w-full h-max",children:[e.jsxs(x,{className:"mr-2 shrink-0",onClick:()=>{c(!0),l(-1)},children:[e.jsx(xe,{className:"h-4 w-4 mr-1"}),n("admin.channels.create")]}),e.jsxs(x,{className:"mr-2 shrink-0",variant:"outline",onClick:()=>N(!0),children:[e.jsx(ts,{className:"h-4 w-4 mr-1"}),n("admin.channels.joint")]}),e.jsx(x,{variant:"outline",size:"icon",className:"ml-auto",onClick:()=>q(!S),children:S?e.jsx(ge,{className:"h-4 w-4"}):e.jsx(us,{className:"h-4 w-4"})}),e.jsx(ss,{bar:P,toggle:C})]}),e.jsxs("div",{className:"flex flex-row items-center mt-4",children:[e.jsx(x,{className:"shrink-0 mr-2",size:"icon",children:e.jsx(ue,{className:"h-4 w-4"})}),e.jsx(k,{className:"grow",value:v,onChange:i=>j(i.target.value),placeholder:n("admin.channels.search-channel")}),e.jsx(x,{variant:"outline",size:"icon",className:"ml-2 shrink-0",onClick:g,children:e.jsx(ve,{className:se("h-4 w-4",o&&"animate-spin")})})]}),S?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:B.map((i,w)=>e.jsxs("div",{onClick:()=>{c(!0),l(i.id)},className:"flex flex-col p-4 border rounded-md cursor-pointer select-none hover:bg-background-hover transition",children:[e.jsxs("div",{className:"flex flex-row items-center w-full",children:[e.jsx(we,{className:se("h-3 w-3 stroke-[3.5] mr-1.5",i.state?"text-green-500":"text-destructive")}),e.jsx("span",{className:"mr-1",children:i.name}),e.jsxs(ye,{variant:"outline",className:"select-none",children:["#",i.id]}),e.jsx(ne,{type:i.type,className:"ml-auto"})]}),e.jsxs("div",{className:"mt-1 grid grid-cols-2 gap-1",children:[e.jsxs("div",{className:"flex flex-row items-center",children:[e.jsx(ps,{className:"h-3.5 w-3.5"}),e.jsx(V,{className:"whitespace-nowrap ml-1 mr-2",children:n("admin.channels.priority")}),e.jsx("span",{className:"font-bold",children:i.priority})]}),e.jsxs("div",{className:"flex flex-row items-center",children:[e.jsx(js,{className:"h-3.5 w-3.5"}),e.jsx(V,{className:"whitespace-nowrap ml-1 mr-2",children:n("admin.channels.weight")}),e.jsx("span",{className:"font-bold",children:i.weight})]}),e.jsxs("div",{className:"flex flex-row items-center",children:[e.jsx(os,{className:"h-3.5 w-3.5"}),e.jsx(V,{className:"whitespace-nowrap ml-1 mr-2",children:n("admin.channels.secret-number")}),e.jsx("span",{className:"font-bold",children:i.secret.split(`
`).filter(t=>t).length})]}),e.jsxs("div",{className:"flex flex-row items-center",children:[e.jsx(vs,{className:"h-3.5 w-3.5"}),e.jsx(V,{className:"whitespace-nowrap ml-1 mr-2",children:n("admin.channels.retry-name")}),e.jsx("span",{className:"font-bold",children:i.retry})]})]}),e.jsxs("div",{className:"flex flex-row items-center space-x-1 mt-2",children:[e.jsx(T,{tooltip:n("admin.channels.edit"),onClick:()=>{c(!0),l(i.id)},children:e.jsx(re,{className:"h-4 w-4"})}),i.state?e.jsx(T,{tooltip:n("admin.channels.disable"),variant:"destructive",onClick:async()=>{const t=await pe(i.id);b(n,t,!0),await g()},children:e.jsx(H,{className:"h-4 w-4"})}):e.jsx(T,{tooltip:n("admin.channels.enable"),onClick:async()=>{const t=await he(i.id);b(n,t,!0),await g()},children:e.jsx(J,{className:"h-4 w-4"})}),e.jsx(T,{tooltip:n("admin.channels.delete"),variant:"destructive",onClick:async()=>{const t=await me(i.id);b(n,t,!0),await g()},children:e.jsx(le,{className:"h-4 w-4"})}),e.jsx("div",{className:"grow"}),e.jsx(fe,{type:i.type,size:28})]})]},w))}):e.jsxs(ns,{className:"channel-table mt-4",children:[e.jsx(as,{children:e.jsxs(de,{className:"select-none whitespace-nowrap",children:[e.jsx(p,{className:d("id"),children:n("admin.channels.id")}),e.jsx(p,{className:d("name"),children:n("admin.channels.name")}),e.jsx(p,{className:d("type"),children:n("admin.channels.type")}),e.jsx(p,{className:d("priority"),children:n("admin.channels.priority")}),e.jsx(p,{className:d("weight"),children:n("admin.channels.weight")}),e.jsx(p,{className:d("secret-number"),children:n("admin.channels.secret-number")}),e.jsx(p,{className:d("retry-name"),children:n("admin.channels.retry-name")}),e.jsx(p,{className:d("state"),children:n("admin.channels.state")}),e.jsx(p,{className:d("action"),children:n("admin.channels.action")})]})}),e.jsx(rs,{children:B.map((i,w)=>e.jsxs(de,{children:[e.jsxs(p,{className:d("id","channel-id select-none"),children:["#",i.id]}),e.jsx(p,{className:d("name"),children:i.name}),e.jsx(p,{className:d("type"),children:e.jsx(ne,{type:i.type})}),e.jsx(p,{className:d("priority"),children:i.priority}),e.jsx(p,{className:d("weight"),children:i.weight}),e.jsx(p,{className:d("secret-number"),children:i.secret.split(`
`).filter(t=>t).length}),e.jsx(p,{className:d("retry-name"),children:i.retry}),e.jsx(p,{className:d("state"),children:i.state?e.jsx(J,{className:"h-4 w-4 text-green-500"}):e.jsx(H,{className:"h-4 w-4 text-destructive"})}),e.jsxs(p,{className:d("action","flex flex-row flex-wrap gap-2"),children:[e.jsx(T,{tooltip:n("admin.channels.edit"),onClick:()=>{c(!0),l(i.id)},children:e.jsx(re,{className:"h-4 w-4"})}),i.state?e.jsx(T,{tooltip:n("admin.channels.disable"),variant:"destructive",onClick:async()=>{const t=await pe(i.id);b(n,t,!0),await g()},children:e.jsx(H,{className:"h-4 w-4"})}):e.jsx(T,{tooltip:n("admin.channels.enable"),onClick:async()=>{const t=await he(i.id);b(n,t,!0),await g()},children:e.jsx(J,{className:"h-4 w-4"})}),e.jsx(T,{tooltip:n("admin.channels.delete"),variant:"destructive",onClick:async()=>{const t=await me(i.id);b(n,t,!0),await g()},children:e.jsx(le,{className:"h-4 w-4"})})]})]},w))})]})]})}function Ss({onPost:s}){const{t:a}=O(),[l,c]=m.useState("");function y(){const h=l.trim();h!==""&&(s(h),c(""))}return e.jsxs("div",{className:"flex flex-row grow gap-0 custom-action",children:[e.jsx(k,{value:l,placeholder:a("admin.channels.add-custom-model"),className:"rounded-r-none",onChange:h=>c(h.target.value),onKeyDown:h=>{Je(h)&&y()}}),e.jsx(x,{className:"rounded-l-none",onClick:y,children:a("add")})]})}function _s(s){return s.name.trim()!==""&&s.models.length>0&&s.secret.trim()!==""&&s.endpoint.trim()!==""}function Ts(s){return s.models=s.models.filter(a=>a.trim()!==""),s.name=s.name.trim(),s.secret=s.secret.trim().split(`
`).filter(a=>a.trim()!=="").join(`
`),s.endpoint=s.endpoint.trim(),s.endpoint.endsWith("/")&&(s.endpoint=s.endpoint.slice(0,-1)),s.mapper=s.mapper.trim().split(`
`).filter(a=>{if(a.trim()==="")return!1;const l=a.split(">");return l.length===2&&l[0].trim()!==""&&l[1].trim()!==""}).join(`
`),s.group=s.group?s.group.filter(a=>a.trim()!==""):[],s.proxy&&s.proxy.proxy.trim()===""&&s.proxy.proxy_type!==0&&(s.proxy.proxy_type=0),s}function Ms({display:s,id:a,edit:l,dispatch:c,setEnabled:y,data:h}){var d,B,i,w,t,E,ae;const{t:n}=O(),v=Pe(),j=m.useMemo(()=>W(l.type),[l.type]),{channelModels:o}=cs(),f=m.useMemo(()=>o.filter(r=>!l.models.includes(r)&&r!==""),[o,l.models]),M=m.useMemo(()=>_s(l),[l]),N=De(Le),S=m.useMemo(()=>[...Object.keys(N).filter(r=>!["anonymous","normal","basic","standard","pro","admin"].includes(r)),...U],[N,l.group,U]),[q,g]=m.useState(!1);function P(r){r&&c({type:"clear"}),y(!1)}async function C(){const r=Ts(l);console.debug("[channel] preflight channel data",r);const u=a===-1?await Ns(r):await Cs(a,r);b(n,u,!0),u.status&&P(!0)}return ee(async()=>{if(a===-1)c({type:"clear"});else{g(!0);const r=await fs(a);g(!1),b(n,r),r.data&&c({type:"set",value:r.data})}},[a]),s&&e.jsxs("div",{className:"channel-editor",children:[e.jsxs("div",{className:"flex flex-row items-center mb-4",children:[q&&e.jsxs(x,{variant:"outline",className:"mr-2",children:[e.jsx($e,{className:"h-4 w-4 animate-spin mr-2 shrink-0"}),n("admin.channels.loading")]}),e.jsxs(x,{variant:"outline",className:"mr-2 shrink-0",onClick:()=>c({type:"clear"}),children:[e.jsx(Ae,{className:"h-4 w-4 mr-1.5"}),n("admin.channels.new")]}),e.jsxs(X,{value:"",onValueChange:r=>{const u=h.find(I=>I.id.toString()===r);u&&(c({type:"import",value:u}),console.debug("[channel] import channel template: ",u))},children:[e.jsx(Ve,{asChild:!0,children:e.jsxs(x,{variant:"outline",className:"mr-2 shrink-0",children:[e.jsx(Be,{className:"h-4 w-4 mr-1.5"}),n("admin.channels.import")]})}),e.jsx(Z,{children:(h||[]).map((r,u)=>e.jsx(A,{value:r.id.toString(),children:e.jsxs("div",{className:"flex flex-row items-center w-full",children:[e.jsx(ms,{className:"h-4 w-4 mr-1"}),r.name,e.jsxs("span",{className:"text-secondary ml-1",children:["#",r.id]}),e.jsx(ne,{type:r.type,className:"ml-1",variant:"outline"})]})},u))})]}),e.jsx("div",{className:"grow"}),e.jsx(x,{variant:"outline",size:"icon",className:"shrink-0",onClick:()=>P(),children:e.jsx(H,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"channel-wrapper w-full h-max",children:[e.jsxs("div",{className:"channel-row",children:[e.jsxs("div",{className:"channel-content",children:[e.jsx(z,{}),n("admin.channels.name"),e.jsx(_,{content:n("admin.channels.name-tip")})]}),e.jsx(k,{value:l.name,placeholder:n("admin.channels.name-placeholder"),onChange:r=>c({type:"name",value:r.target.value})})]}),e.jsxs("div",{className:"channel-row",children:[e.jsxs("div",{className:"channel-content",children:[e.jsx(z,{}),n("admin.channels.type")]}),e.jsxs(X,{value:l.type,onValueChange:r=>c({type:"type",value:r}),children:[e.jsx(ce,{children:e.jsx(ie,{placeholder:n("admin.channels.type")})}),e.jsx(Z,{children:e.jsx(te,{children:Object.entries(is).map(([r,u],I)=>e.jsx(A,{value:r,children:u},I))})})]}),j.description&&e.jsx(Ie,{className:"channel-description mt-4 mb-1",children:j.description})]}),e.jsxs("div",{className:"channel-row",children:[e.jsxs("div",{className:"channel-content",children:[e.jsx(z,{}),n("admin.channels.model")]}),e.jsx("div",{className:"channel-model-wrapper",children:l.models.map((r,u)=>e.jsxs("div",{className:"channel-model-item cursor-pointer",onClick:()=>v(r),children:[r,e.jsx(H,{className:"remove-action",onClick:I=>{I.stopPropagation(),c({type:"remove-model",value:r})}})]},u))}),e.jsxs("div",{className:"channel-model-action mt-4",children:[e.jsxs(ze,{children:[e.jsx(He,{asChild:!0,children:e.jsxs(x,{children:[e.jsx(ue,{className:"h-4 w-4 mr-2"}),n("admin.channels.add-model")]})}),e.jsx(Oe,{align:"start",asChild:!0,children:e.jsxs(qe,{children:[e.jsx(Ee,{placeholder:n("admin.channels.search-model")}),e.jsx(Re,{className:"thin-scrollbar",children:f.map((r,u)=>e.jsx(Fe,{value:r,onSelect:()=>c({type:"add-model",value:r}),className:"px-2",children:r},u))})]})})]}),e.jsx(Ss,{onPost:r=>{const u=r.split(" ");c({type:"add-models",value:u})}}),e.jsx(x,{onClick:()=>c({type:"add-models",value:j.models}),children:n("admin.channels.fill-template-models",{number:j.models.length})}),e.jsx(x,{variant:"outline",onClick:()=>c({type:"clear-models"}),children:n("admin.channels.clear-models")})]})]}),e.jsxs("div",{className:"channel-row",children:[e.jsxs("div",{className:"channel-content",children:[e.jsx(z,{}),n("admin.channels.secret")]}),e.jsx(Ge,{value:l.secret,placeholder:n("admin.channels.secret-placeholder",{format:j.format}),onChange:r=>c({type:"secret",value:r.target.value})})]}),e.jsxs("div",{className:"channel-row",children:[e.jsxs("div",{className:"channel-content",children:[e.jsx(z,{}),n("admin.channels.endpoint")]}),e.jsx(k,{value:l.endpoint,placeholder:n("admin.channels.endpoint-placeholder"),onChange:r=>c({type:"endpoint",value:r.target.value})})]}),e.jsxs("div",{className:"channel-row",children:[e.jsxs("div",{className:"channel-content",children:[n("admin.channels.priority"),e.jsx(_,{content:n("admin.channels.priority-tip")})]}),e.jsx(Q,{value:l.priority,acceptNegative:!0,onValueChange:r=>c({type:"priority",value:r})})]}),e.jsxs("div",{className:"channel-row",children:[e.jsxs("div",{className:"channel-content",children:[n("admin.channels.weight"),e.jsx(_,{content:n("admin.channels.weight-tip")})]}),e.jsx(Q,{value:l.weight,min:1,onValueChange:r=>c({type:"weight",value:r})})]}),e.jsxs("div",{className:"channel-row",children:[e.jsxs("div",{className:"channel-content",children:[n("admin.channels.retry"),e.jsx(_,{content:n("admin.channels.retry-tip")})]}),e.jsx(Q,{value:l.retry,min:1,onValueChange:r=>c({type:"retry",value:r})})]}),e.jsxs("div",{className:"channel-row",children:[e.jsxs("div",{className:"channel-content",children:[n("admin.channels.mapper"),e.jsx(_,{content:n("admin.channels.mapper-tip")})]}),e.jsx(We,{rows:5,value:l.mapper,placeholder:n("admin.channels.mapper-placeholder"),onChange:r=>c({type:"mapper",value:r.target.value})})]}),e.jsxs(ds,{title:n("admin.channels.advanced"),isCollapsed:!0,children:[e.jsx(D,{children:e.jsx("div",{className:"channel-row column-layout",children:e.jsxs("div",{className:"channel-content flex flex-row items-center justify-between w-full",children:[e.jsxs("div",{className:"flex flex-row items-center gap-1",children:[n("admin.channels.first-message-as-user"),e.jsx(_,{content:n("admin.channels.first-message-as-user-tip")})]}),e.jsx(oe,{checked:l.first_message_as_user||!1,onCheckedChange:r=>c({type:"set-first-message-as-user",value:r})})]})})}),e.jsx(G,{children:n("admin.channels.first-message-as-user-desc")}),e.jsx(Y,{}),e.jsx(D,{children:e.jsx("div",{className:"channel-row column-layout",children:e.jsxs("div",{className:"channel-content flex flex-row items-center justify-between w-full",children:[e.jsxs("div",{className:"flex flex-row items-center gap-1",children:[n("admin.channels.merge-consecutive-user-messages"),e.jsx(_,{content:n("admin.channels.merge-consecutive-user-messages-tip")})]}),e.jsx(oe,{checked:l.merge_consecutive_user_messages||!1,onCheckedChange:r=>c({type:"set-merge-consecutive-user-messages",value:r})})]})})}),e.jsx(G,{children:n("admin.channels.merge-consecutive-user-messages-desc")}),e.jsx(Y,{}),e.jsx(D,{children:e.jsxs("div",{className:"channel-row column-layout",children:[e.jsxs("div",{className:"channel-content",children:[n("admin.channels.group"),e.jsx(_,{content:n("admin.channels.group-tip")})]}),e.jsx(Ke,{className:"w-full max-w-full",value:l.group||[],align:"end",onChange:r=>c({type:"set-group",value:r}),list:S,listTranslateFormatter:r=>U.includes(r)?n(`admin.channels.groups.${r}`):`${r} (${n("admin.custom-group")})`,placeholder:n("admin.channels.group-placeholder",{length:(l.group||[]).length})})]})}),e.jsx(G,{children:n("admin.channels.group-desc")}),e.jsx(Y,{}),e.jsx(D,{children:e.jsxs("div",{className:"channel-row column-layout",children:[e.jsx("div",{className:"channel-content",children:n("admin.channels.proxy-type")}),e.jsxs(X,{value:(((d=l.proxy)==null?void 0:d.proxy_type)||0).toString(),onValueChange:r=>c({type:"set-proxy-type",value:parseInt(r)}),children:[e.jsx(ce,{children:e.jsx(ie,{})}),e.jsx(Z,{children:e.jsxs(te,{children:[e.jsx(A,{value:"0",children:R[F.NoneProxy]}),e.jsx(A,{value:"1",children:R[F.HttpProxy]}),e.jsx(A,{value:"2",children:R[F.HttpsProxy]}),e.jsx(A,{value:"3",children:R[F.Socks5Proxy]})]})})]})]})}),e.jsxs(D,{children:[e.jsx("div",{className:"channel-content",children:n("admin.channels.proxy-endpoint")}),e.jsx(k,{value:((B=l.proxy)==null?void 0:B.proxy)||"",placeholder:n("admin.channels.proxy-endpoint-placeholder"),onChange:r=>c({type:"set-proxy",value:r.target.value}),disabled:((i=l.proxy)==null?void 0:i.proxy_type)===0})]}),e.jsxs(D,{children:[e.jsx("div",{className:"channel-content",children:n("admin.channels.proxy-username")}),e.jsx(k,{value:((w=l.proxy)==null?void 0:w.username)||"",placeholder:n("admin.channels.proxy-username-placeholder"),onChange:r=>c({type:"set-proxy-username",value:r.target.value}),disabled:((t=l.proxy)==null?void 0:t.proxy_type)===0})]}),e.jsxs(D,{children:[e.jsx("div",{className:"channel-content",children:n("admin.channels.proxy-password")}),e.jsx(k,{value:((E=l.proxy)==null?void 0:E.password)||"",placeholder:n("admin.channels.proxy-password-placeholder"),onChange:r=>c({type:"set-proxy-password",value:r.target.value}),disabled:((ae=l.proxy)==null?void 0:ae.proxy_type)===0})]}),e.jsx(G,{children:n("admin.channels.proxy-desc")})]})]}),e.jsxs("div",{className:"mt-4 flex flex-row w-full h-max pr-2 items-center",children:[e.jsxs("div",{className:"object-id",children:[e.jsx("span",{className:"mr-2",children:"ID"}),l.id===-1?e.jsx(xe,{className:"w-3 h-3"}):e.jsx("span",{className:"id",children:l.id})]}),e.jsx("div",{className:"grow"}),e.jsx(x,{variant:"outline",onClick:()=>P(),children:n("cancel")}),e.jsx(x,{className:"ml-2",loading:!0,onClick:C,disabled:!M,children:n("confirm")})]})]})}const Ps={proxy:"",proxy_type:0,username:"",password:""},je={id:-1,type:"openai",name:"",models:[],priority:0,weight:1,retry:3,secret:"",endpoint:W().endpoint,mapper:"",state:!0,group:[],proxy:{...Ps}};function Ds(s,a){var l,c,y,h,n,v,j,o,f,M,N,S;switch(a.type){case"type":const g=W(s.type).endpoint!==s.endpoint&&s.endpoint.trim()!==""?s.endpoint:W(a.value).endpoint;return{...s,endpoint:g,type:a.value};case"name":return{...s,name:a.value};case"models":return{...s,models:a.value};case"add-model":return s.models.includes(a.value)||a.value===""?s:{...s,models:[...s.models,a.value]};case"add-models":const P=a.value.filter(C=>!s.models.includes(C)&&C!=="");return{...s,models:[...s.models,...P]};case"remove-model":return{...s,models:s.models.filter(C=>C!==a.value)};case"clear-models":return{...s,models:[]};case"priority":return{...s,priority:a.value};case"weight":return{...s,weight:a.value};case"secret":return{...s,secret:a.value};case"endpoint":return{...s,endpoint:a.value};case"mapper":return{...s,mapper:a.value};case"retry":return{...s,retry:a.value};case"clear":return{...je};case"add-group":return{...s,group:s.group?[...s.group,a.value]:[a.value]};case"remove-group":return{...s,group:s.group?s.group.filter(C=>C!==a.value):[]};case"set-group":return{...s,group:a.value};case"set-proxy":return{...s,proxy:{proxy:a.value,proxy_type:((l=s==null?void 0:s.proxy)==null?void 0:l.proxy_type)||0,password:((c=s==null?void 0:s.proxy)==null?void 0:c.password)||"",username:((y=s==null?void 0:s.proxy)==null?void 0:y.username)||""}};case"set-proxy-type":return{...s,proxy:{proxy:((h=s==null?void 0:s.proxy)==null?void 0:h.proxy)||"",proxy_type:a.value,password:((n=s==null?void 0:s.proxy)==null?void 0:n.password)||"",username:((v=s==null?void 0:s.proxy)==null?void 0:v.username)||""}};case"set-proxy-username":return{...s,proxy:{proxy:((j=s==null?void 0:s.proxy)==null?void 0:j.proxy)||"",proxy_type:((o=s==null?void 0:s.proxy)==null?void 0:o.proxy_type)||0,password:((f=s==null?void 0:s.proxy)==null?void 0:f.password)||"",username:a.value}};case"set-proxy-password":return{...s,proxy:{proxy:((M=s==null?void 0:s.proxy)==null?void 0:M.proxy)||"",proxy_type:((N=s==null?void 0:s.proxy)==null?void 0:N.proxy_type)||0,password:a.value,username:((S=s==null?void 0:s.proxy)==null?void 0:S.username)||""}};case"set-first-message-as-user":return{...s,first_message_as_user:a.value};case"set-merge-consecutive-user-messages":return{...s,merge_consecutive_user_messages:a.value};case"set":return{...s,...a.value};case"import":return{...s,...a.value,id:s.id,state:s.state};default:return s}}function Ls(){const[s]=Xe(),[a,l]=m.useState(s.get("editor_id")!==null&&s.get("editor_id")!=="empty"),[c,y]=m.useState(s.get("editor_id")!==null&&s.get("editor_id")!=="empty"?parseInt(s.get("editor_id")||"-1"):-1),[h,n]=m.useState([]),[v,j]=m.useReducer(Ds,{...je});return m.useEffect(()=>{a?window.history.replaceState({},"",`?editor_id=${c}`):window.history.replaceState({},"","?editor_id=empty")},[a,c]),e.jsxs(e.Fragment,{children:[e.jsx(ks,{setEnabled:l,setId:y,display:!a,dispatch:j,data:h,setData:n}),e.jsx(Ms,{setEnabled:l,id:c,display:a,edit:v,data:h,dispatch:j})]})}function Fs(){const{t:s}=O();return e.jsx("div",{className:"channel",children:e.jsxs(Ze,{className:"admin-card channel-card",children:[e.jsx(Qe,{className:"select-none",children:e.jsx(Ue,{children:s("admin.channel")})}),e.jsx(Ye,{children:e.jsx(Ls,{})})]})})}export{Fs as default};
